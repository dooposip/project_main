<!doctype html>
<html lang="ko">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <title>travel</title>
</head>
<body>

<!-- 기본 템플릿 안에 삽입될 내용 Start -->
{% extends 'base.html' %}
{% block content %}
<div class="container my-3">
    <!--flash오류-->
    {% for message in get_flashed_messages() %}
    <div class="alert alert-danger">
        {{ message }}
    </div>
    {% endfor %}
    <!-- 질문 -->
    <h2 class="border-bottom py-2">{{ notice.subject }}</h2>
    <div class="card my-3">
        <div class="card-body">
            <div class="card-text" style="white-space: pre-line;">{{ notice.content }}</div>
            <div class="d-flex justify-content-end">
                <div class="badge bg-light text-dark p-2">
                    {{ notice.user.username }} <br>
                    {{ notice.create_date.strftime('%Y-%m-%d %H:%M') }}
                    {% if notice.modify_date %}
                    <div>
                        <p class="mt-2 mb-0">modified at</p>
                        <p>{{ notice.modify_date.strftime('%Y-%m-%d %H:%M') }}</p>
                    </div>
                    {% endif %}
                     <div class="my-3">
                        {% if g.user == notice.user %}
                        <a href="{{ url_for('notice.modify', notice_id=notice.id) }}"
                           class="btn btn-sm btn-outline-secondary">수정</a>
                        <button class="btn btn-sm btn-outline-danger delete"
                        data-uri="{{ url_for('notice.delete', notice_id=notice.id) }}">삭제
                        </button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 답변 목록 -->
    <h5 class="border-bottom my-3 py-2">{{ notice.comment_set|length }}개의 답변이 있습니다.</h5>
    {% for comment in notice.comment_set %}
    <div class="card my-3">
        <div class="card-body">
            <div class="card-text" style="white-space: pre-line;">{{ comment.content }}</div>
            <div class="d-flex justify-content-end">
                <div class="badge bg-light text-dark p-2">
                    {{ comment.user.username }} <br>
                    {{ comment.create_date.strftime('%Y-%m-%d %H:%M') }}
                    {% if comment.modify_date %}
                    <div>
                        <p class="mt-2 mb-0">modified at</p>
                        <p>{{ comment.modify_date.strftime('%Y-%m-%d %H:%M') }}</p>
                    </div>
                    {% endif %}
                    <div class="my-3">
                        {% if g.user == comment.user %}
                        <a href="{{ url_for('comment.modify', comment_id=comment.id) }}"
                           class="btn btn-sm btn-outline-secondary">수정</a>
                        <button class="btn btn-sm btn-outline-danger delete"
                        data-uri="{{ url_for('comment.delete', comment_id=comment.id) }}">삭제
                        </button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    <!-- 답변 등록 -->
    <form action="{{ url_for('comment.create', notice_id=notice.id) }}" method="post" class="my-3">
        {{ form.csrf_token }}
        <!--        오류표시 Start-->
        {% if form.errors %}
        <div class="alert alert-danger" role="alert">
            {% for field, errors in form.errors.items() %}
            <strong>{{ form[field].label }}</strong>
            <ul>
                {% for error in errors %}
                <li>{{ error }}</li>
                {% endfor %}
            </ul>
            {% endfor %}
        </div>
        {% endif %}
        <!--        오류표시 End-->

        <div class="mb-3">
            <textarea name="content" id="content" class="form-control" rows="10"
                      {% if not g.user %}disabled{% endif %}></textarea>
        </div>
        <input type="submit" value="답변등록" class="btn btn-primary"
               {% if not g.user %}disabled{% endif %}>
    </form>
</div>
{% endblock %}
{% block script %}
<script>
    const delete_elements = document.querySelectorAll('.delete')
    delete_elements.forEach(function (element) {
        element.addEventListener('click', function () {
            if (confirm('정말로 삭제하시겠습니까?')) {
                location.href = this.dataset.uri
            }
        });
    });
</script>
{% endblock %}

</body>
</html>